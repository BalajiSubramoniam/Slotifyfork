<!-- app/auth/templates/register.html -->
{% extends "base.html" %}
{% block title %}Register{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('auth.static', filename='css/register.css') }}">
{% endblock %}

{% block content %}
{% include "flash_msgs.html" %}

<div class="register-container">
    <div class="card shadow-lg">
        <div class="card-body">

            <!-- Back Button -->
            <a href="{{ url_for('main.index') }}" class="btn btn-outline-secondary btn-back">
                <i class="bi bi-arrow-left me-1"></i> Back to Home
            </a>

            <h2 class="card-title">
                <i class="bi bi-person-plus-fill me-2 text-primary"></i> Create a New Account
            </h2>

            <form method="POST" action="{{ url_for('auth.register') }}" novalidate>

                {{ form.hidden_tag() }}

                <!-- Username -->
                <div class="form-floating mb-3">
                    {{ form.username(class="form-control", placeholder="Choose a username", id="username") }}
                    <label for="username">
                        <i class="bi bi-person-circle"></i> {{ form.username.label.text }} <span class="text-danger">*</span>
                    </label>
                    {% if form.username.errors %}
                    <div class="text-danger small">{{ form.username.errors[0] }}</div>
                    {% endif %}
                </div>

                <!-- First Name -->
                <div class="form-floating mb-3">
                    {{ form.first_name(class="form-control", placeholder="First name", id="first_name") }}
                    <label for="first_name">
                        <i class="bi bi-person"></i> {{ form.first_name.label.text }} <span class="text-danger">*</span>
                    </label>
                    {% if form.first_name.errors %}
                    <div class="text-danger small">{{ form.first_name.errors[0] }}</div>
                    {% endif %}
                </div>

                <!-- Middle Name (optional) -->
                <div class="form-floating mb-3">
                    {{ form.middle_name(class="form-control", placeholder="Middle name (optional)", id="middle_name") }}
                    <label for="middle_name"><i class="bi bi-person"></i> {{ form.middle_name.label.text }}</label>
                </div>

                <!-- Last Name (optional) -->
                <div class="form-floating mb-3">
                    {{ form.last_name(class="form-control", placeholder="Last name", id="last_name") }}
                    <label for="last_name"><i class="bi bi-person"></i> {{ form.last_name.label.text }}</label>
                    {% if form.last_name.errors %}
                        <div class="text-danger small">{{ form.last_name.errors[0] }}</div>
                    {% endif %}
                </div>

                <!-- Email -->
                <div class="form-floating mb-3">
                    {{ form.email(class="form-control", placeholder="Email address", id="email") }}
                    <label for="email">
                        <i class="bi bi-envelope"></i> {{ form.email.label.text }} <span class="text-danger">*</span>
                    </label>
                    {% if form.email.errors %}
                    <div class="text-danger small">{{ form.email.errors[0] }}</div>
                    {% endif %}
                </div>

                <!-- Password -->
                <div class="form-floating mb-3">
                    {{ form.password(class="form-control", placeholder="Create a strong password", id="password") }}
                    <label for="password">
                        <i class="bi bi-shield-lock"></i> {{ form.password.label.text }} <span class="text-danger">*</span>
                    </label>
                    {% if form.password.errors %}
                    <div class="text-danger small">{{ form.password.errors[0] }}</div>
                    {% endif %}
                </div>

                <!-- Confirm Password -->
                <div class="form-floating mb-3">
                    {{ form.confirm_password(class="form-control", placeholder="Re-enter your password", id="confirm_password") }}
                    <label for="confirm_password"><i class="bi bi-shield-lock"></i> Confirm Password</label>
                    {% if form.confirm_password.errors %}
                        <div class="text-danger small">{{ form.confirm_password.errors[0] }}</div>
                    {% endif %}
                </div>

                <!-- Contact Number (optional) -->
                <div class="form-floating mb-3">
                    {{ form.contact_no(class="form-control", placeholder="Contact number (optional)", id="contact_no") }}
                    <label for="contact_no"><i class="bi bi-telephone"></i> {{ form.contact_no.label.text }}</label>
                </div>

                <!-- Room Number -->
                <div class="form-floating mb-3">
                    {{ form.room_no(class="form-control", placeholder="Room number (optional)", id="room_no") }}
                    <label for="room_no"><i class="bi bi-door-open"></i> {{ form.room_no.label.text }}</label>
                </div>

                <!-- Building UUID -->
                <div class="form-floating mb-3">
                    {{ form.building_uuid(class="form-select", id="building_uuid") }}
                    <label for="building_uuid">
                        <i class="bi bi-building"></i> {{ form.building_uuid.label.text }} <span class="text-danger">*</span>
                    </label>
                    {% if form.building_uuid.errors %}
                    <div class="text-danger small">{{ form.building_uuid.errors[0] }}</div>
                    {% endif %}
                </div>

                <!-- Course UUID (select) -->
                <div class="form-floating mb-4">
                    {{ form.course_uuid(class="form-select", id="course_uuid") }}
                    <label for="course_uuid">
                        <i class="bi bi-journal-bookmark"></i> {{ form.course_uuid.label.text }} <span class="text-danger">*</span>
                    </label>
                    {% if form.course_uuid.errors %}
                    <div class="text-danger small">{{ form.course_uuid.errors[0] }}</div>
                    {% endif %}
                </div>

                <div class="d-grid">
                    <button id="submit-btn" type="submit" class="btn btn-primary btn-lg">
                        <span id="spinner" class="spinner-border spinner-border-sm me-2 d-none" role="status" aria-hidden="true"></span>
                        <span id="btn-text"><i class="bi bi-check-circle me-1"></i> {{ form.submit.label.text }}</span>
                    </button>
                </div>

            </form>

        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.querySelector('form').addEventListener('submit', function () {
        const btn = document.getElementById('submit-btn');
        const spinner = document.getElementById('spinner');
        const btnText = document.getElementById('btn-text');

        btn.disabled = true;
        spinner.classList.remove('d-none');
        btnText.textContent = 'Registering...';
    });
</script>
{% endblock %}
